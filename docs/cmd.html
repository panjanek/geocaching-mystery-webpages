<html>
  <head>
    <link rel="icon" type="image/x-icon" href="icon.png">
	<title>CMD Czarne Okienko</title>
	<meta name="viewport" content="width=800, height=device-height, user-scalable=no"  /> <!-- , initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no -->
    <style>
	.center {
		  margin: auto;
		  width: min-content;
		  border: 1px solid gray;
		  padding: 10px;
	}
	
	.footer {
		position: fixed; 
		bottom: 0;
		left: 0;
		right: 0;
		height: 50px;
		background: white
	}
	</style>
  </head>
  <body style="height: 100%;">
    <div style="width: min-content;margin: auto;font-family: Courier;padding: 10px;">
      <p>Użyj&nbspklawiatury&nbsp/&nbspUse&nbspkeyboard</p>
	</div>  
    <div class="center">
      <canvas  id="c" width="800" height="480"></canvas>
	</div>
    <div style="width: min-content;margin: auto;font-family: Courier;padding: 10px;">
      <input style="font-size: 32px;" type="text" id="mobile" placeholder="tap here on mobile" style="border: 0;" autocapitalize="none" autocomplete="off" autocorrect="off" spellcheck="false"/>
	</div>
	<div class="footer">
	  <div style="width: min-content;margin: auto;font-family: Courier"><strong>Czarne&nbspOkienko</strong>&nbspby&nbspPanJanek123</div>
	</div>
	<div style="display:none;">
	  <img
		id="egg2"
		src="gc2048b.png"
		width="2048"
		height="2048" />
	</div>	
	<script>
const questions = [ 
  {
	  "pl" : "Zeszyt kosztuje o 100 więcej niż ołówek. Razem kosztują 110. Ile kosztuje zeszyt?",
	  "en" : "Notebook costs 100 more than pencil. Together they cost 110. How much is the notebook?"
  },
  {
	  "pl" : "15 maszyn produkuje 15 zabawek w 15 minut. Ile minut potrzeba aby 150 maszyn wyprodukowało 150 zabawek?",
	  "en" : "15 machines produce 15 toys in 15 minutes. How many minutes it takes for 150 machines to produce 150 toys?"
  },
  {
	  "pl" : "Lilia zarasta jezioro w ten sposób, że każdego dnia pokrywa dwukrotnie większą jego powierzchnię. Po 48 dniach całe jezioro jest zarośnięte. Po ilu dniach jest zarośnięte w połowie?",
	  "en" : "Lily grows in a lake in a way that each day doubles the surface. After 48 days entire lake in covered. After how many days half the lake is covered?"
  },
  {
	  "pl" : "Masz 50 jedynek. Możesz je dowolnie dodawać, mnożyć i wstawiać nawiasy. Jaka jest największa liczba jaką możesz dostać?(podpowiedzi: AI, 8 cyfr)",
	  "en" : "You have 50 ones. You can add, multiply and add brackets in any way you want. What is the biggest number you can get? (hints: AI, 8 digits)"
  },  
  {
	  "pl" : "Hipoteza Goldbacha mówi, że każdą liczbę parzystą da się przedstawić jako sumę dwóch liczb pierwszych.\n Okazuje się, że większość liczb parzystych da się przedstawić jako sumę dwóch liczb pierwszych na wiele sposobów. Np. 10 da się przedstawić na dwa sposoby: 7+3 i 5+5. Na ile sposobów da się przedstawić 1000?",
	  "en" : "Goldbach conjectrue says that each even number can be expresses as sum of two primes. It turns out that most even numbers can be expressed as a sum of two primes in more than one way. For example 10 can be expressed in two ways: 7+3 and 5+5. In how many ways it is possible to express 1000?"
  }, 
  {
	  "pl" : "Według pewnej powieści komediowo-SF: Jak brzmi ostateczna odpowiedź na pytanie o Życie, Wszechświat i Całą Resztę?",
	  "en" : "According to some comedy-SF novel: What is the answer to the final question about Live, The Universe and Everything?"
  },    
  {
	  "pl" : "Biegniesz z prędkością 10km/h trasę o długości 10km: 5km tam i 5km spowrotem. Równo z Tobą startuje szybki biegacz który biegnie 2x szybciej i powolny który biegnie 2x wolniej. Po drodze mija Ciebie biegnący naprzeciw szybki biegacz, a potem, po nawrocie na 5km, Ty mijasz powolnego (biegnącego naprzeciw). Ile minut mija pomiędzy tymi spotkaniami?",
	  "en" : "You run 10km route: 5km there and 5km back. Together with you starts: a fast runner that runs 2x your speed and a slow runner that runs half your speed. During the run the fast runner pass you by and then you pass by the slow runner. How many minutes passes between this meeting?"
  },
  {
	  "pl" : "Kwadrat jest ograniczony czterema odcinkami. Szcześcian jest ograniczony 6cioma ścianami. Iloma figurami (9-wymiarowymi) jest ograniczona 10-wymiarowa hiperkostka?",
	  "en" : "Square is constrained by four lines. Cube is constrained by 6 faces. How many shapes (9d) constrain 10-dimensional hypercube?"
  },
  {
	  "pl" : "Obserwujesz przez teleskop swojego brata bliźniaka w statku kosmicznym oddalającego się od Ciebie z 99% prędkości światła. Widzisz u niego znacznie wolniej chodzący zegar. Czekasz aż u niego minie godzina. Ile w tym czasie czasu minie u Ciebie? Podaj liczbę sekund zaokrągloną do najbliższej liczby całkowitej.",
	  "en" : "You observe, with a telescope, your twin brother in a spaceship moving away at 99% speed of light. You see his clock ticking much slower. You wait for an hour to pass on his clock. How much time passes for you till then? Answer with seconds rounded to closest integer."
  },
  {
	  "pl" : "Ile liczb pierwszych znajduje się pomiędzy liczbami będącymi odpowiedziami na pytania 4te i 9te?",
	  "en" : "How many prime there is between the numbers being answers for questions 4th and 9th?"
  },    
];

const nextMsgs = 
[
  {
	  "pl" : "Ok. Zobaczymy...",
	  "en" : "Ok. We'll see..."
  },
  {
	  "pl" : "Może i dobrze...",
	  "en" : "This may by right..."
  },
  {
	  "pl" : "Napewno? Zobaczymy.",
	  "en" : "You sure? We'll see."
  },
  {
	  "pl" : "Ok. Może.",
	  "en" : "Ok. Maybe."
  },  
  {
	  "pl" : "Wygląda dobrze.",
	  "en" : "Seems right."
  },  
  {
	  "pl" : "Może być.",
	  "en" : "Could be."
  },  
];

const folders = 
{
    name: "C:",
	access: true,
	dir:true,
    content: 
	[
		{name: "DOS", access: false, dir:true},
		{name: "DOKUMENTY", access: true, dir:true, content: 
		  [
		    {name: "POMYSLY.TXT", access: true, dir:false, data: "Pomysły na skrytki.\nZaszyfrowane hasłem, bo to cenne informacje.\nAES-128-CBC (IV zeros), PBKDF2-SHA (523056505130464453456c4f523064465430644654773d3d, 1000)\n\n8b7a4760c7f796e8e19a51dd395cbc35\n7cb946ff70b49c72ab71f24386e3612f\nf24ce9e35179d5e8fe87e03bdf7dadb6\n809eed2d3dd4c2a65cdfdc9a48e78096\n1f619c3800df14f6f2bc6578e081ec04\n26eafbaa0762858cf55e36a82e812d5a\n48809a815a968efce778675f55ec0fef\n791b7be2beb80f51e0cd035adfdc4aec\n7fa82e49e8abc7d7d352a526c08f4ebb\n9a58ec8c567fa5a417469c05f2094aab\nca12fe2a7685117edb39081bcdde6a28\nbfe31a4f7c0c92e7f24067c785406b1e\nef65a46106bc637f8d3551f0d42f46e4\n\n" },
		  ]
		},
		{name: "DEMOS", access: true, dir:true, content: 
		  [
		      {name: "SCNDREAL.EXE", access:true, dir:false, url: "https://www.youtube.com/watch?v=L33eQfT72yo"},
			  {name: "LOGUST5.EXE", access:true, dir:false, url: "https://www.youtube.com/watch?v=oA3ISi7Phnc"},
			  {name: "SUPER.EXE", access:true, dir:false, url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ"}
		  ]
		},
		{name: "MUSIC", access: true, dir:true, content: 
		  [
		      {name: "PLAYER.EXE", access:true, dir:false },
			  {name: "AURORA.MOD", access:true, dir:false, audio: "aurora.mp3", info: "Hymne to Aurora by Horace / Wimp."},
			  {name: "DISASTER.MOD", access:true, dir:false, audio: "disaster.mp3", info: "notion disaster (c) 1996 by estrayk & evelred / c.a.p.s.u.l.e."}	 ,
			  {name: "ECONOMY17.MOD", access:true, dir:false, audio: "economy17.mp3", info: "## economy 17 ## by XDT / Mystic."},
			  {name: "EX-DA-17.XM", access:true, dir:false, audio: "ex-da-17.mp3", info: "Ex Da 17 by REViSQ / Nah."},
			  {name: "MICRO.MOD", access:true, dir:false, audio: "micro.mp3", info: "MICRO by PanJanek123 (c) 1998"},
			  {name: "TETSUO.XM", access:true, dir:false, audio: "tetsuo.mp3", info: "Tetsuo Crashing by Nitro/Dubius (c) 1996 Finland."},
			  {name: "VIVAFM.MOD", access:true, dir:false, audio: "vivafm.mp3", info: "unknown author"}
		  ]
		},		
		{name: "PROGRAMY", access: true, dir:true, content: 
		  [
		      {name: "NC", access:false, dir:true},
			  {name: "MKSVIR", access:false, dir:true},
			  {name: "TAG", access:false, dir:true}
		  ]
		},		
		{name: "GRY", access: true, dir:true, content: 
		  [
			{name: "GEOCACHE", access: true, dir:true, content: 
			  [
			    {name: "LOG.TXT", access: true, dir:false, data: "\nFTF:\nSTF:\nTTF:\n" },
				{name: "ASCIIART.TXT", access: true, dir: false, data: "\n\n@@BG@@@@@#G#@@@@B&@@@@?    !@@@@@@@@@@@@@@@@@@@@@@\n@@#~7#@@G...B@#?7@@@@@?    !@@@@@@@@@@@@@@@@@@@@@@\n@@#P7!YGGYPYG?.?@@@@@@?    :?J5G#@@@@@@@@@@@@@@@@@\n@&PPPJ7..~7!.~B@@@@@@@?         .^75#@@@@@@@@@@@@@\n@@@PY#@Y     ?G&@@@@@@?    ^Y?!:    Y@@@@@@@@@@@@@\n@@@@@@#^  !J!. .7G@@@@?    !@@@@BY7G@@@@@@@@@@@@@@\n@@@@@&^  !@@@&P:  ~G@@?    !@@@@@@@@@@@@&PB@@@@@@@\n@@@@@J  .#@@@@@&?^::5@?    !@@@@@@@@@@#7: .G@@@@@@\n@@@@@:  ^@@@@@@@@@@&#@?    !@@@@@@@@@@@?   .B@@@@@\n@@@@&.  ^@@@@@@@@@@@@@?    !@@@@@@@@@@@@7   ~@@@@@\nBBBBP.  :BBBBBBBBBBBBB7    ~BGGGGGGGGGGB5    5BGGG\n                                                  \n                                                  \nPPPPG!   ^GPPPPPPPPPPG7    ~GPPPPPPPPPPPPPPPPPPPPP\n@@@@@G   .#@@@@@@@@@@@J    !@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@7   ^#@@@@@@@@@@J    !@@@@#!~~~~~~~~~^~?G@@@\n@@@@@@&~  .J@@@@@@@@@@J    !@@@@@^        :?G@@@@@\n@@@@@@@&J5&@@@@@@@@@@@J    !@@@@@J     ^?G@@@@@@@@\n@@@@@@@@@@@@@@@P5#@@@@J    !@@@@@B  :?G@@@@@@@@@@@\n@@@@@@@@@@@@@&7  .^7YP7    !@@@@@@^7@@@@@@@@@@@@@@\n@@@@@@@@@@@@@&Y!:          !@@@@@@J^@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@&B5J7~:    !@@@@@@B.B@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@J    !@@@@@@@^J@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@J    !@@@@@@@GG@@@@@@@@@@@@@\n\n" },
				{name: "GEO.TXT", access: true, dir: false, data: "               _____                           _     _              \n"+
"              / ____|                         | |   (_)             \n"+
"             | |  __  ___  ___   ___ __ _  ___| |__  _ _ __   __ _  \n"+
"             | | |_ |/ _ \\/ _ \\ / __/ _` |/ __| '_ \\| | '_ \\ / _` | \n"+
"             | |__| |  __/ (_) | (_| (_| | (__| | | | | | | | (_| | \n"+
"              \\_____|\\___|\\___/ \\___\\__,_|\\___|_| |_|_|_| |_|\\__, | \n"+
"                          _____       _            _          __/ | \n"+
"                         |  __ \\     | |          | |        |___/  \n"+ 
"                         | |__) |   _| | ___ ____ | |               \n"+            
"                         |  _  / | | | |/ _ \\_  / | |               \n"+           
"                         | | \\ \\ |_| | |  __// /  |_|               \n"+           
"                         |_|  \\_\\__,_|_|\\___/___| (_)               \n" },
				{name: "QUIZ", access: true, dir:true, content:
				  [
					{name: "QUIZ.DAT", access: true, dir:false },
					{name: "QUIZ.EXE", access: true, dir:false },
					{name: "INFO.TXT", access: true, dir:false }
				  ]}
			  ]},
			{name: "MAZE", access: true, dir:true, content:
			  [
					{name: "MAZE.DAT", access: true, dir:false },
					{name: "MAZE.EXE", access: true, dir:false },
					{name: "MAZE.TXT", access: true, dir:false }		  
			  ]},			  
			{name: "SNAKE", access: true, dir:true, content:
			  [
					{name: "SNAKE.DAT", access: true, dir:false },
					{name: "SNAKE.EXE", access: true, dir:false },
					{name: "SNAKE.TXT", access: true, dir:false }		  
			  ]}		  
		  ]},
		  {name: "AUTOEXEC.BAT", access: true, dir:false, data:"SET TRM=C:\\WIN311\\TEMP\nSET TEMP=C:\\WIN311\\TEMP\nSET BLASTER=A220 I5 D1 T1" },
		  {name: "CONFIG.SYS", access: true, dir:false, data:"NUMLOCK = OFF\nDOS=HIGH,UMB\nFILES=30\nBUFFERS=20"},
		  {name: "COMMAND.COM", access: false, dir:false},
		  {name: "README.TXT", access: true, dir:false, data: "Supported commands: DIR, CD, TYPE. Enter name of EXE file to run program.\nObsługiwane komendy: DIR, CD, TYPE. Wpisz nazwę pliku EXE żeby uruchomić dany program.\n"},
		  {name: "WIN311", access: false, dir:true},
    ]
};

var curPath = [folders];
var dosCommands = ["MD", "COPY", "RD", "DEL", "REN", "MKDIR", "RMDIR", "EDIT", "FORMAT", "XCOPY", "TREE", "ATTRIB", "MODE", "DISKCOPY", "MEM", "SCANDISK",
                   "UNDELETE", "ASSIGN", "FDISK", "BACKUP", "RESTORE", "MSCDEX", "SYS", "SHARE", "SMARTDRV", "SETVER", "FC", "FIND", "PATH", "SET", "SUBST",
				   "EDLIN", "DEBUG", "HIMEM.SYS", "UNFORMAT", "GRAPHICS", "QBASIC", "KEYB", "CHOICE", "DISKCOMP", "PRINT", "SORT", "APPEND", "ASSOC",
				   "LABEL", "RECOVER", "FASTOPEN", "GOTO", "SHIFT", "JOIN", "BATCH", "CALL"];

const gc = [0	,2093056	,6323712	,8392576	,16778176	,33816800	,67502192	,134611000	,134610968	,268566536	,268566556	,268503032	,268517368	,805421064	,807305228	,
            821084172	,870334476	,864051212	,268460044	,268460044	,134225944	,134230040	,67121176	,33554480	,58720352	,12583104	,7340416	,925440	,122880	,0	 ];
     
	    var curX = 0;
		var curY = 0;
		var curColor = "white";
		var cursorVisible = true;		
		var defaultFont = "16px Courier New";
	    const canvas = document.getElementById("c");
		const mobileInput = document.getElementById("mobile");
	    const ctx = canvas.getContext("2d");
		ctx.textBaseline = "top";
		ctx.textAlign = "left";
		ctx.font = defaultFont;
		const charWidth = 10;
		const charHeight = 16;
		var promptHistory = [];
		var w = canvas.width;
		var h = canvas.height;
		var coursorInterval;
		var playerAudio = null;
		var audioInterval = null;
		var readPrompt = true;
		var readMode = false;
		var readCallback;
		var readString = "";
		var easterEggTimeout;	
		var snake = [];
		var snakeInterval;
		var snakeMode = false;
		var snakeDir = [];
		var snakeLastT = 0;
		var snakeApple = [];
		var snakeScore = 0;
		var snakeStartT = -1;
		var snakeStartDelay = 160;
		var snakeGameOver = false;
		var snakeObstacles = [[7,10,40,6], [48,40,40,6], [71, 11, 18, 18], [11,31,13,13]];
		var scrollText1 = "            ***            Witaj w grze Snake [by PanJanek123 (c)2024]. Ta gra jest tylko dodatkiem do mystery kesza 'Czarne Okienko'. Aby rozwiązać zagadkę musisz odnaleźć program QUIZ.EXE, uruchomić go i odpowiedzieć na pytania. Gra SNAKE to tylko bonus. Na marginesie: Nie jeśli jesteś hackerem i sprawdziłeś, że ta aplikacja WEBowa nie ma żadnego backendu to wiesz, że rozwiązanie - współrzędne finału - muszą znajdować się w kodzie javascript. To by oznaczało, że może mółbyś je tam odszukać... Jednak nie jest to takie proste! Współrzędne są zaszyfrowane, a kluczem są odpowiedzi na pytania quizu. Więc, oczywiście, możesz próbować robić brute-force, jednak żeby to się udało musisz znać odpowiedzi przynajmniej na część pytań. Plus kod jest obfuskowany i zminifikowany. Chyba serio łatwiej będzie po prostu odpowiedzieć na pytania... Powodzenia!";
		var scrollText2 = "            ***            Welcome to the game of Snake [by PanJanek123 (c)2024]. This is only an addition to mystery cache 'Czarne Okienko' (Black window in polish). To solve the mystery you have to find QUIZ.EXE program, run it and answer the questions. Game of SNAKE is only a bonus. If you are a hacker and you've checked that this web app does not use any backend then you know that the solution - final coords - has to be somwhere in javascript code. This would suggest that you could find then there... But it won't be so easy! Coordinates are encrypted and the key consist of answers to the quiz. So, sure, you can try to brute-force the encryption, but to succeed you have to know the answers for at least some questions. Plus: The code is obfuscated and minified. I think it will be easier just to answer the questions. Good luck!";
	    var mazeSize = 10;
	    var maze;
	    var mazePx = 0;
	    var mazePy = 0;
	    var mazeNx = 0;
	    var mazeNy = 0;	  
	    var mazeAnimationStarted = 0;
	    var mazeAnimationCallback;
	    var mazeProgress = 0;
	    var mazeAllowed = [];		
		var mazeMode = false;
		var mazeSteps = 0;
		var mazeScore = [];
		var mazeLevel = 0;
		var egg2StartT = -1;
		
		const egg2MD5 = '7359C3EB5C57547295A76AC1BF775B29';
		const keySalt = '8bf32485128d4706bad955467948d7b0';
		const expectedMD5 = 'BF5B41FC8D17EB704799DF457F60F037';
		const encryptedSolution = '2B133D3B2F60F5461466F8FD219F6E0D06E9C04535493ABC9FC2A0584F30F7E5F90B5E8E7BF99F5427C1B910BE';
		const easterEggPwd = ":)";
		
		const b64binb = base64String => Uint8Array.from(atob(base64String), c => c.charCodeAt(0));
		const str2binb = str => new TextEncoder().encode(str);
		const buf2hex = buffer => Array.prototype.map.call(new Uint8Array(buffer), x => ('00' + x.toString(16)).slice(-2)).join('');
		const fromHex = hexString => new Uint8Array(hexString.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
		const fromBase64 = base64String => Uint8Array.from(atob(base64String), c => c.charCodeAt(0));
		var MD5 = function(d){var r = M(V(Y(X(d),8*d.length)));return r.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}


		
		var language = "pl";
		var answers = ""
		var invalid = 0;
		var questionNr = 0;
		var easterEggMode = false;
		var easterEggMode2 = false;

		function handleCoursor() {
			var ms300 = Math.floor(Date.now()/300);
			ctx.fillStyle = (ms300%2==0 && cursorVisible) ? curColor : "black";
			ctx.fillRect(curX*charWidth, curY*charHeight, charWidth, charHeight);
		}
		
		function startCoursor() {
		  handleCoursor();
		  coursorInterval = setInterval(handleCoursor, 300);
		}
		
		function stopCoursor() {
		  handleCoursor();
		  clearInterval(coursorInterval);
		}
		
		startCoursor();
		
		function checkVertical() {
		  if (curY*charHeight >= h-1) {
			ctx.drawImage(canvas, 0, -charHeight);
			ctx.fillStyle = "black";
			ctx.fillRect(0, h-charHeight, w, charHeight);
			curY--;
		  }
		}
		
		function advanceCoursor() {
		  curX++;
		  if (curX*charWidth >= w-1) {
		    curX = 0;
			curY++;
			checkVertical();
		  }			
		}
		
		function printChar(c) {
		  stopCoursor();
		  ctx.fillStyle = "black";
		  ctx.fillRect(curX*charWidth, curY*charHeight, charWidth, charHeight);		  
		  ctx.fillStyle = curColor;
          ctx.fillText(c,curX*charWidth,curY*charHeight);
		  advanceCoursor();
		  startCoursor();
		}
		
		function moveTo(x, y) {
		  stopCoursor();
		  ctx.fillStyle = "black";
		  ctx.fillRect(curX*charWidth, curY*charHeight, charWidth, charHeight);	  
		  curX = x;
		  curY = y;
		  checkVertical();
		  startCoursor();
		}
		
		function newLine() {
		    moveTo(0, curY+1);
		}
		
		function setColor(color) {
		    curColor = color;
		}
		
		function coursorVisible(v) {
		    cursorVisible = v;
		}
		
		function printText(text){
          for(var i=0; i<text.length; i++) {
		      if (text[i]=='\n')
			    newLine();
			  else
		        printChar(text[i]);
		  }
		}
		
		function printTextSlow(text, callback, ms) {
		    var i = 0;
			setTimeout(function(){
			    if (text.length==0) {
				    callback()
                } else {
				    printChar(text[0]);
					printTextSlow(text.substring(1), callback, ms);
				}
	        }, ms??20);
		}
		
		function str_pad_left(string, pad, length) {
		  return (new Array(length + 1).join(pad) + string).slice(-length);
		}
		
		function prettyTime(time) {
		  minutes = Math.floor(time / 60);
		  seconds = time - minutes * 60;
		  return str_pad_left(minutes, '0', 2) + ':' + str_pad_left(seconds, '0', 2);		
		}
		
		function handleKey(key) {
		    if (readMode) {
			    if (key.length == 1) {
				  readString += key;
				  printChar(key);
				}
				
				if (key == "ArrowUp" && readPrompt && promptHistory.length > 0 && readString.length == 0) {
				    readString = promptHistory[promptHistory.length-1];
					printText(readString);
				}
				
				if (key == "Backspace" && readString.length>0) {
				  readString = readString.substring(0, readString.length-1);
				  var nx = curX-1;
				  var ny = curY;
				  if (nx<0) {
				      nx = w/charWidth;
					  ny--;
				  }
				  moveTo(nx, ny);
				  printChar(" ");
				  moveTo(nx, ny);
				}				
				
				if (key == "Enter") {
				  readMode = false;
				  newLine();
				  setColor("yellow");
				  readCallback(readString);
				}
			} else if (easterEggMode) {
			    clearTimeout(easterEggTimeout);
			    easterEggMode = false;
				setTimeout(_=> {
				  newLine();
				  runPrompt();
				}, 200);
			} else if (easterEggMode2) {
			    easterEggMode2 = false;
				playerAudio.pause();
				setTimeout(_=> {
				  newLine();
				  runPrompt();
				}, 200);
		    } else if (snakeMode) {
			  if (snakeGameOver) {
			      if ((key=="Escape" || key == "d" || key == "D") || key == "q" || key == "Q" || key == "x" || key=="X") {
                    snakeExit();
			      } else if (key=="p" || key == "P") {
                    runSnake();
			      }
			  } else {
				  if ((key=="ArrowRight" || key == "d" || key == "D") && !(snakeDir[0] == -1 && snakeDir[1] == 0)) {
					changeSnakeDir([1,0]); 
				  } else if ((key=="ArrowLeft" || key == "a" || key == "A") && !(snakeDir[0] == 1 && snakeDir[1] == 0)) {
					changeSnakeDir([-1,0]);
				  } else if ((key=="ArrowUp" || key == "w" || key == "W") && !(snakeDir[0] == 0 && snakeDir[1] == 1)) {
					changeSnakeDir([0,-1]);
				  } else if ((key=="ArrowDown" || key == "s" || key == "S") && !(snakeDir[0] == 0 && snakeDir[1] == -1)) {
					changeSnakeDir([0,1]);
				  } else if ((key=="Escape" || key == "d" || key == "D") || key == "q" || key == "Q" || key == "x" || key=="X") {
					snakeExit();
				  }
			  }
			} else if (playerAudio!=null) {
			    playerAudio.pause();
				exitAudio();
			} else if (mazeMode) {
			    if (mazeLevel == 51) {
			      if ((key=="Escape" || key == "d" || key == "D") || key == "q" || key == "Q" || key == "x" || key=="X") {
                    mazeExit();
			      } else if (key=="p" || key == "P") {
				    mazeScore = [];
                    runMaze(1);
			      }
				} else {
					var m = maze[mazePy*mazeSize+mazePx];
					if ((key == "ArrowDown") && (mazePy<mazeSize-1) && ((m&8)!=0) && mazeProgress==0) {
					  mazeStartAnimation(mazePx, mazePy+1, drawMaze);
					} else if ((key == "ArrowRight") && (mazePx<mazeSize-1) && ((m&4)!=0) && mazeProgress==0) {
					  mazeStartAnimation(mazePx+1, mazePy, drawMaze);
					} else if ((key == "ArrowUp") && (mazePy>0) && ((m&2)!=0) && mazeProgress==0) {
					  mazeStartAnimation(mazePx, mazePy-1, drawMaze);
					} else if ((key == "ArrowLeft") && (mazePx>0) && ((m&1)!=0) && mazeProgress==0) {
					  mazeStartAnimation(mazePx-1, mazePy, drawMaze);
					} else if ((key=="Escape" || key == "d" || key == "D") || key == "q" || key == "Q" || key == "x" || key=="X") {
					  mazeExit();
					}
				}
			}
		}
		
		document.onkeydown = function(evt) {
		    if (snakeMode || mazeMode || (readPrompt && evt.key.length == "ArrowUp")) {
		      evt.preventDefault();
			}
		    if (evt.target.id != "mobile") {
			    handleKey(evt.key);
			}
		};		
		
		function exitAudio() {
		    clearInterval(audioInterval);
		    playerAudio=null;
			coursorVisible(true);
			printText("\n\n");
			runPrompt();
		}
		
		function snakeExit() {
		    clearInterval(snakeInterval);
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, w, h);	
            moveTo(0,0);
            coursorVisible(true);
			snakeMode = false;
            runPrompt();			
		}
		
		function mazeExit() {
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, w, h);	
            moveTo(0,0);
            coursorVisible(true);
			mazeMode = false;
			mazeScore = [];
            runPrompt();			
		}		
		
		function changeSnakeDir(newDir) {
			snakeDir = newDir; 
			clearInterval(snakeInterval);
			snakeStep();
			snakeInterval = setInterval(snakeStep, snakeDelay);		
		}
		
	
		
		mobile.addEventListener('input', function(evt) {
		  
		  if( evt.inputType.toUpperCase() == "insertText".toUpperCase()){
			for(var i=0; i<evt.data.length; i++) {
			  handleKey(evt.data[i]);
			}
			
			if (evt.data.length > 1) {
			  handleKey("Enter");
			}
		  }
		});
		
		mobile.addEventListener('keyup', function(e){
            if (e.keyCode === 13) { 
			  mobileInput.value = '';
			  handleKey("Enter");
			}
        });

        function readText(callback) {
		    setColor("lightgreen");
		    readMode = true;
			readCallback = callback;
			readString = "";
        }	

        function question(text, callback) {
		    setColor("yellow");
			printTextSlow(text, function() {
			    readText(function(answer) {
				    callback(answer);
				})
			});		
        }	

        function prompt(text, callback) {
		    setColor("lightgreen");
			printText(text);	
			readPrompt = true;
			readText(function(input) {
			    if (input.length > 0) {
				    promptHistory.push(input);
				}
				readPrompt = false;
				callback(input);
			});		
        }			
		
		function easterEggDrop(x, y) {
		    if (easterEggMode) {
				var maxy = h / charHeight;
				var maxx =w / charWidth	
				if (y < maxy-1) {
					var characters = "!@#$%^&*()+[]<>";
					var r = Math.floor(Math.random() * 150);
					var c = characters[Math.floor(Math.random() * characters.length) % characters.length];
					moveTo(x,y);
					setColor("lightgreen");
					printChar(c);
					setTimeout(_=>{
						moveTo(x,y);
						var b = 0;
						if (x >=(maxx/2)-30 && x < (maxx/2)+30 && y<30) {
							var n = gc[y];
							var mask = 1 << (30-((x-((maxx/2)-30))/2));
							b = n & mask;
						}
						
						setColor(b ? "lime" : "green");
						printChar(c);
						easterEggDrop(x, y+1);
					}, 75+r);	
				}
			}
		}
		
		function startEesterEgg() {
		    easterEggMode = true;
		    coursorVisible(false);
			var maxx = w / charWidth;	
			var x = Math.floor(Math.random() * maxx) % maxx;
			easterEggDrop(x, 0);
			var r = Math.floor(Math.random() * 150);
			easterEggTimeout = setTimeout(_=>{
				startEesterEgg();
			}, 80+r);		
		}
		
		function pbkdf2(text, callback) {
		     var passphrase = new TextEncoder().encode(text);
			 window.crypto.subtle.importKey("raw", passphrase, { name: "PBKDF2" }, false, ["deriveBits"])
			.then(function(passphraseImported){
				window.crypto.subtle.deriveBits(
					{
						name: "PBKDF2",
						hash: 'SHA-512',
						salt: new TextEncoder().encode(keySalt),
						iterations: 100000
					},
					passphraseImported, 
					256 
				)  
				.then(function (bits) { 
					var keyHex = buf2hex(new Uint8Array(bits));
					callback(keyHex);
				}); 
			});
		}

		async function decrypt(keyHex, text, callback) {
			const keyBytes = fromHex(keyHex);
			const ivBytes = fromHex(text.substring(0, 32));
			const encryptedTextBytes = fromHex(text.substring(32));
			const key = await window.crypto.subtle.importKey(   
				"raw",
				keyBytes,                                         
				"AES-CTR",
				true,
				["encrypt", "decrypt"]
			);
			const decrypted = await window.crypto.subtle.decrypt(
				{
					name: "AES-CTR",
					counter: ivBytes,
					length: 64
				},
				key,
				encryptedTextBytes
			);

			var decryptedText =  new TextDecoder().decode(decrypted);
			callback(decryptedText);
		}
		
		function preprocess(text) {
		    return text.trim().replace(/ +(?= )/g,'');
		}
		
		function fancyShowSolution(callback) {
		    coursorVisible(false);
			setColor("deepskyblue");
            pbkdf2(answers, function(keyHex) {			    
				decrypt(keyHex, encryptedSolution, function(decryptedText){
					console.log(decryptedText);
                    var lines = decryptedText.split('\n');
				   	var line1 = lines[0];
					var line2 = lines[1];
					var mask1 = " ".repeat(line1.length);
					var mask2 = " ".repeat(line2.length);
					var t = 0;
					var signs = "!@#$%^&*()_+-=<>?,./:<>?;':{}[]";
					var maxt = 300;
					var lx = (w/charWidth) / 2 - line1.length / 2;
					var ly = (h/charHeight) / 2 - 1;
					var makeNoise = function() {
						setTimeout(_=>{
							var c = signs[Math.floor((Math.random() * (signs.length-1)))];
							var rx = Math.floor(Math.random() * line1.length);
							var ry = Math.floor(Math.random() * 2);
							var v = (ry == 0) ? line1[rx] : line2[rx];
							var m = (ry == 0) ? mask1[rx] : mask2[rx];
							if (((t > (maxt/2)) && ((Math.random()*maxt)  < t)) || (m == "*")) {
								c = v;
								if (ry == 0) {
  								    mask1 = mask1.substring(0, rx) + "*" + mask1.substring(rx+1);
							    } else {
								    mask2 = mask2.substring(0, rx) + "*" + mask2.substring(rx+1);
								}
							}
							moveTo(lx+rx, ly+ry);	
							printChar(c);
							t++;
							if (t<maxt) {
								makeNoise();
							} else {
							   moveTo(lx, ly);
							   printText(line1);
							   moveTo(lx, ly+1);
							   printText(line2);
							   newLine();newLine();newLine();newLine();newLine();newLine();newLine();newLine();newLine();newLine();newLine();newLine();
							   coursorVisible(true);
							   question(language == "en" ? "Hit enter to finish" : "Naciśnij enter aby wyjść", _=>{
								   callback();
							   });
							}
						},5);
					};
					makeNoise();
				});
			});
		}
		
		function finishQuiz(callback) {
			newLine();
			newLine();
			var answersMD5 = MD5(answers).toUpperCase();	
			if (answersMD5 == expectedMD5) {
				setColor("white");
				printTextSlow(language == "en" ? "Contratulations!!! All answers are correct. Decrypting final coordinates:" : "Gratulacje! Wszystkie odpowiedzi są poprawne: Odszyfrowywanie współrzędnych finału:", _=>{
					var l = (h / charHeight)-1;
					var il = setInterval(_=> {
					    l--;
						if (l == 0) {
						    clearInterval(il);
							fancyShowSolution(callback);
						} else {
						    newLine();
						}
					}, 30);
					
				});
			} else {
				setColor("red");
				printTextSlow(language == "en" ? "Unfortunatelly! At least one anser is incorrect. You have to try again." : "Niestety! Conajmniej jedna odpowiedź nie jest prawidłowa. Próbuj dalej.", _=>{
					newLine();
					newLine();
					newLine();
					question(language == "en" ? "Hit enter to restart\n" : "Naciśnij enter aby spróbować jeszcze raz", _=>{
						answers="";
						questionNr = 0;
						invalid = 0;
						askNextQuestion();
					});
				});
			}
		}
		
		function askNextQuestion() {
			if (questionNr < questions.length) { 
			    newLine();
				question(`${(questionNr+1)}. ${questions[questionNr][language]}: `, function(answer) {
				    newLine();
					if (answer == easterEggPwd) {
						startEesterEgg();
					} else if (answer.length == 0) {
					      printTextSlow(language == "en" ? ("Please provide non-empty answer."+(invalid==0?"":" (Focus this time) ")+"\n") : "Podaj niepustą odpowiedź."+(invalid==0?"":" (Tym raze skup się) ")+"\n", _=>{
						  invalid++;
						  askNextQuestion();
					  });
					} else if (answer.toLowerCase() == "exit") {
					  printTextSlow(language == "en" ? "Good bye!\n" : "Do widzenia!\n" , _=>{
					     newLine();
					     runPrompt();
					  });
					} else if (!(/^\d+$/.test(answer))) {
					      printTextSlow(language == "en" ? "Answer should only contain digits."+(invalid==0?"":" (Focus this time) ")+"\n" : "Odpowiedź powinna zawierać wyłącznie cyfry."+(invalid==0?"":" (Tym raze skup się) ")+"\n", _=>{
						  invalid++;
						  askNextQuestion();
					  });			  
					} else {
					      setColor("lightgray");
					      printTextSlow(`${nextMsgs[questionNr%nextMsgs.length][language]}` , _=>{
						  answers+=answer;
						  questionNr++;
						  newLine();
						  askNextQuestion();
					  }); 			 
					}
				});
			} else {
                finishQuiz(_=>{newLine();runPrompt();});
			}
		}		
		
	    function runQuiz() {
		    answers="";
			questionNr = 0;
			invalid = 0;
	        question("Select language / Wybierz język: pl=Polski (domyślny), en=English: ", function(lang) {
				if (lang == easterEggPwd) {
					startEesterEgg();
				} else if (lang.length==0 || lang.toLowerCase()=="pl") {
				    newLine();
					language = "pl"
					printTextSlow("Wybrano: Polski.\nOdpowiedz poprawnie na 10 pytań aby poznać współrzędne finału.\nOdpowiedzi zawsze są liczbami.\nW każdej chwili możesz opuścić program wpisując 'exit'.\nSprawdzenie poprawności odpowiedzi nastąpi dopiero na końcu.\nPowodzenia!\n", _=>{
					    newLine();
						askNextQuestion();
					}, 2);
				} else if (lang.toLowerCase()=="en") {
				    newLine();
					language = "en"
					printTextSlow("Selected: English.\nAnswer correctly 10 questions to get the final coordinates.\nAll answers consist of digits only.\nYou can always exit the program by typing 'exit'.\nThe result of this quiz will be displayd at the end.\nGood luck!\n", _=>{
					    newLine();
						askNextQuestion();
					}, 2);
				} else {
					printTextSlow("Spróbuj jeszcze raz (skupiając się) / Focus and try again.\n", _=>{
						runQuiz();
					});
				}
	        });		
		}
		
		function drawScrollHoriz(t, text, color, lx, ly, len) {
			var scrollOffset = Math.floor(t/100) % text.length;
			var pixelOffset = Math.floor((t % 100)/charWidth);
			var part = (text + text).substring(scrollOffset, scrollOffset+len);
			ctx.fillStyle = color;
			for(var i=0; i<part.length; i++) {
				ctx.fillText(part[i], lx+i*charWidth-pixelOffset, ly);
			}		
		}
		
		function drawScrollVert(t, text, color, lx, ly, len) {
		    var bigW = 85;
			var scrollOffset = Math.floor(t/1000) % text.length;
			var pixelOffset = Math.floor(((t % 1000)*bigW)/1000.0);
			var part = (text + text).substring(scrollOffset, scrollOffset+len);
			ctx.fillStyle = color;
			ctx.font="bold 120px Courier New";
			for(var i=0; i<part.length; i++) {
				ctx.fillText(part[i], lx, ly+i*bigW-pixelOffset);
			}	
            ctx.font=defaultFont;			
		}
		
		function diagonalScroll(t, color, lx, ly, len1, len2) {
		    var codes = document.getElementsByTagName('script');
			var code = "";
			for(var i=0; i<codes.length; i++) { code+=codes[i].innerHTML;}
			var lines = code.split('\n');
            var ratio = charHeight / charWidth;
			for(var l=0; l<=len2; l++) {
				var lineOffset = Math.floor(t/100) % lines.length;
				var pixelOffsetY = (Math.floor((t % 100)/charWidth))*ratio;
				var line = lines[(lineOffset+l)%lines.length];
				if (line.length == 0) {
				    line = "// ";
				}
				line = line.repeat(lines.length / line.length);
				var letterOffset = Math.floor(t/100) % line.length;
				var pixelOffsetX = Math.floor((t % 100)/charWidth);
				var part = (line+line).substring(letterOffset, letterOffset+len1);
				ctx.fillStyle = color;
				for(var i=0; i<part.length; i++) {
					ctx.fillText(part[i], lx+i*charWidth-pixelOffsetX, ly+l*charHeight-pixelOffsetY);
				}			
			}
		}		
		
		function drawSnake(t) {
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, w, h);
			var d = 8;
			
			for(var i=0; i<snakeObstacles.length; i++) {
			  var o = snakeObstacles[i];	
			  ctx.fillStyle = "black";
			  ctx.fillRect(o[0]*d+d, o[1]*d+d, o[2]*d-2*d, o[3]*d-2*d);						  
			}


			if (t) {
				drawScrollHoriz(t*0.8, scrollText1, "lime", snakeObstacles[0][0]*d+16, snakeObstacles[0][1]*d+16, (snakeObstacles[0][2]*d)/charWidth-2);
				drawScrollHoriz(t*0.6, scrollText2, "lime", snakeObstacles[1][0]*d+16, snakeObstacles[1][1]*d+16, (snakeObstacles[1][2]*d)/charWidth-2);
				diagonalScroll(t*1.5, "lime", snakeObstacles[2][0]*d+16, snakeObstacles[2][1]*d+16, (snakeObstacles[2][2]*d)/charWidth-2, (snakeObstacles[2][3]*d)/charHeight-2);
				drawScrollVert(t*1.5, "*SNAKE*", "lime", snakeObstacles[3][0]*d+16, snakeObstacles[3][1]*d+16, 2);
				snakeLastT = t;
			}

			ctx.fillStyle = "black";
			ctx.fillRect(snakeObstacles[3][0]*d-4*d, snakeObstacles[3][1]*d-8*d, snakeObstacles[3][2]*d+8*d, 8*d);
            ctx.fillRect(snakeObstacles[3][0]*d-4*d, (snakeObstacles[3][1]+snakeObstacles[3][3])*d, snakeObstacles[3][2]*d+8*d, 11*d);				
			for(var i=0; i<snakeObstacles.length; i++) {
			  var o = snakeObstacles[i];
			  ctx.fillStyle = "black";
			  ctx.fillRect(o[0]*d, o[1]*d, o[2]*d, d);	
              ctx.fillRect(o[0]*d, o[1]*d, d, o[3]*d);	
              ctx.fillRect(o[0]*d, (o[1]+o[3]-1)*d, o[2]*d, d);	
              ctx.fillRect((o[0]+o[2]-1)*d, o[1]*d, d, o[3]*d);				  
			  ctx.fillStyle = "green";
			  ctx.fillRect((o[0]+1)*d, (o[1]+1)*d, (o[2]-2)*d, d);	
              ctx.fillRect((o[0]+1)*d, (o[1]+1)*d, d, (o[3]-2)*d);	
              ctx.fillRect((o[0]+1)*d, (o[1]+o[3]-2)*d, (o[2]-2)*d, d);	
              ctx.fillRect((o[0]+o[2]-2)*d, (o[1]+1)*d, d, (o[3]-2)*d);						  
				  
			}			
			
			ctx.fillStyle = "green";		
			ctx.fillRect(0, 0, w, d);     	
			ctx.fillRect(0, 0, d, h-charHeight);
			ctx.fillRect(w-d, 0, w, h-charHeight);					
			ctx.fillRect(0, h-charHeight-d, w, d);	
			
			ctx.beginPath();
			ctx.arc(snakeApple[0]*d+d/2, snakeApple[1]*d+d/2, d/2, 0, 2 * Math.PI);
			ctx.fillStyle = 'lime';
			ctx.fill();
            ctx.closePath();					
			for(var i=0; i<snake.length; i++) {
			  ctx.fillStyle = snakeGameOver ? "red" : (i==0 ? "yellow" : "lightgreen");	
			  ctx.fillRect(snake[i][0]*d, snake[i][1]*d, d, d);	
			}

            setColor("yellow");
            moveTo(0,h/charHeight - 1);
            printText("Score: "+snakeScore);
            setColor("lightgreen");			
            moveTo((w/charWidth)-35, h/charHeight - 1);
            printText("controls: [\u2190\u2191\u2192\u2193] or [ASWD], E[x]it");				
		}
		
		function snakeAnimation(t) {
		    if (snakeMode && !snakeGameOver) {
			    if (snakeStartT == -1 && t>0) {
				    snakeStartT = t;
				}
				
				console.log(snakeStartT);
			    drawSnake(1+t-snakeStartT);
		        window.requestAnimationFrame(snakeAnimation)
			}
		}
		
		function snakeShowGameOver() {
		    snakeGameOver = true;
		    clearInterval(snakeInterval);
			drawSnake(snakeLastT, true);
			var cx = (w/charWidth) / 2;
			var cy = (h/charHeight) / 2;
			moveTo(cx-7,cy-1);
			setColor("red");
			printText("   GAME OVER   ")
			moveTo(cx-7,cy);
			setColor("yellow");
			printText("   Score: "+snakeScore);
			moveTo(cx-11,cy+1);
			printText("[P]lay again or E[x]it");
			ctx.fillStyle = "red";		
			ctx.fillRect((cx-13)*charWidth, (cy-2)*charHeight, 27*charWidth-2, 8);  			
			ctx.fillRect((cx-13)*charWidth, (cy+2)*charHeight+4, 27*charWidth-2, 8); 
            ctx.fillRect((cx-13)*charWidth, (cy-2)*charHeight, 8, 4*charHeight+4); 
            ctx.fillRect((cx+13)*charWidth, (cy-2)*charHeight, 8, 4*charHeight+4); 			
		}
		
		function snakeStep() {
			drawSnake();
			for(var i = 1; i<snake.length; i++) {
			  if (snake[i][0] == snake[0][0] && snake[i][1] == snake[0][1]) {
			    snakeShowGameOver();
			  }
			}			
			
		    if (snake[0][0] == snakeApple[0] && snake[0][1] == snakeApple[1]) {
			    snake.push([[snake[0][0],snake[0][1]]]);
			    snakeScore++;
			    snakeDelay -= 5;
			    if (snakeDelay < 20) {
			      snakeDelay = 20;
			    }
			    var taken = false;
			    do {
			        taken = false;
			        snakeApple = [Math.floor(Math.random()*(w/8 - 4))+2, Math.floor(Math.random()*(h/8 - 8))+2];
					for(var i = 0; i<snake.length; i++) {
					  if (snakeApple[0] == snake[i][0] && snakeApple[1] == snake[i][1]) {
						taken=true;
					  }
					}
				  
					for(var i = 0; i<snakeObstacles.length; i++) {
					  var o = snakeObstacles[i];
					  if (snakeApple[0] >= (o[0]-1) && snakeApple[0] < (o[0]+o[2]+2) && snakeApple[1] >= (o[1]-1) && snakeApple[1] < (o[1]+o[3]+2)) {
						taken = true;
					  }
					}				  
				} while (taken);
			}
			
			for(var i = snake.length-1; i>0; i--) {
			  snake[i][1] = snake[i-1][1];
              snake[i][0] = snake[i-1][0];
			}
			
			snake[0][0] += snakeDir[0];
			snake[0][1] += snakeDir[1];
			
			var colision = false;
			if (snake[0][0] <= 0 || snake[0][0] >= w/8 || snake[0][1] <=0 || snake[0][1] >= h/8-3) {
			  colision = true;
			}	
			
			for(var i = 0; i<snakeObstacles.length; i++) {
			  var o = snakeObstacles[i];
			  if (snake[0][0] > o[0] && snake[0][0] < (o[0]+o[2]-1) && snake[0][1] > o[1] && snake[0][1] < (o[1]+o[3]-1)) {
			    colision = true;
			  }
			}
			
			if (colision) {
			  snakeShowGameOver();
            }
		}
		
		function runSnake() {
		    snakeGameOver = false;
			snakeStartT = -1;
            moveTo(0,0);
			stopCoursor();
			coursorVisible(false);
			snakeMode = true;
			snakeScore = 0;
			snake = [[14,5],[13,5],[12,5],[11,5],[10,5]];
			snakeApple = [55,5];
			snakeDir = [1,0];
			snakeDelay = snakeStartDelay;
			snakeInterval = setInterval(snakeStep, snakeDelay);
			snakeAnimation();
		}
		
		  function splitmix32(a) {
		   return function() {
			 a |= 0;
			 a = a + 0x9e3779b9 | 0;
			 let t = a ^ a >>> 16;
			 t = Math.imul(t, 0x21f0aaad);
			 t = t ^ t >>> 15;
			 t = Math.imul(t, 0x735a2d97);
			 return ((t = t ^ t >>> 15) >>> 0);
			}
		  }
		  
		  function shuffle(array, prng) {
			let currentIndex = array.length;
			while (currentIndex != 0) {
			  let randomIndex = prng() % currentIndex;
			  currentIndex--;
			  [array[currentIndex], array[randomIndex]] = [
				array[randomIndex], array[currentIndex]];
			}
		  }
		  
		  function traverse(maze, x, y, visited, n, prng) {
			visited[y*n+x] = true;
			var d = [[0, -1,0],[1, 0,-1], [2, 1,0], [3, 0, 1]];
			shuffle(d, prng);
			for(var k=0; k<d.length; k++) {
			  var index = d[k][0];
			  var dx = d[k][1];
			  var dy = d[k][2];
			  if (x+dx>=0 && x+dx<n && y+dy>=0 && y+dy<n && !visited[(y+dy)*n + (x+dx)]) {
				  maze[y*n+x] = maze[y*n+x] | (1<<index);
				  maze[(y+dy)*n+x+dx] = maze[(y+dy)*n+x+dx] | (1<<((index+2)%4));
				  traverse(maze, x+dx, y+dy, visited, n, prng);
			  }
			}
		  }		
		  
		  function createMaze(n, seed) {
			const prng = splitmix32(seed);
			var visited = new Array(n*n).fill(false);
			var maze = new Array(n*n).fill(0);
			traverse(maze, 0, 0, visited, n, prng);
			return maze;
		  }		  

		  function drawLine(ctx, x1,y1, x2, y2) {
			ctx.beginPath();
			ctx.moveTo(x1, y1);
			ctx.lineTo(x2, y2);
			ctx.closePath();
			ctx.stroke();
		  }
	  
		  function drawMaze() { 
			var topMargin = 8;
			var leftMargin = (w-h)/2 - 2*topMargin;
			var d = (h-2*8)/mazeSize;
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, w, h);
			allowed = [];
			for(var x=0; x<mazeSize; x++) {
			  for(var y=0; y<mazeSize; y++) {
				var x1 = x*d;
				var y1 = y*d;
				var x2 = x*d+d;
				var y2 = y*d+d;
				var tile = {x: leftMargin+x1+1, y: topMargin+y1+1, w: x2-x1-2, h: y2-y1-2};
				var m = maze[y*mazeSize+x];
				ctx.strokeStyle = 'lightgreen';
				if ((m&1)==0) drawLine(ctx, leftMargin+x1,topMargin+y1,leftMargin+x1,topMargin+y2); else if (x==mazePx+1 && y == mazePy) allowed.push(tile);
				if ((m&2)==0) drawLine(ctx, leftMargin+x1,topMargin+y1,leftMargin+x2,topMargin+y1); else if (x==mazePx && y == mazePy+1) allowed.push(tile);
				if ((m&4)==0) drawLine(ctx, leftMargin+x2,topMargin+y1,leftMargin+x2,topMargin+y2); else if (x==mazePx-1 && y == mazePy) allowed.push(tile);
				if ((m&8)==0) drawLine(ctx, leftMargin+x2,topMargin+y2,leftMargin+x1,topMargin+y2); else if (x==mazePx && y == mazePy-1) allowed.push(tile);
			  }
			}

            ctx.fillStyle = "yellow";
			ctx.beginPath();
			ctx.arc(leftMargin+mazePx*d+d/2, topMargin+mazePy*d+d/2, d/3, 0, 2 * Math.PI);
			ctx.fillStyle = 'red';
			ctx.fill();		
			
            ctx.strokeStyle = 'red';
			ctx.lineWidth = 2;
            drawLine(ctx, leftMargin+(mazeSize-1)*d+3, topMargin+(mazeSize-1)*d+3, leftMargin+(mazeSize-1)*d+d-4, topMargin+(mazeSize-1)*d+d-4);	
            drawLine(ctx, leftMargin+(mazeSize-1)*d+d-4, topMargin+(mazeSize-1)*d+3, leftMargin+(mazeSize-1)*d+3, topMargin+(mazeSize-1)*d+d-4);
            ctx.lineWidth = 1; 	

            setColor("lightgreen")
            moveTo(1,0);
            printText("Maze v1.1");	
			moveTo(1,1);
            printText("[X\u2190\u2191\u2192\u2193ASWD]");		

			for(var i=0; i<mazeScore.length; i++) {
				moveTo(3+i < 29 ? 1 : 62, (3+i) < 29 ? (3+i) : (1+i-26));
				printText("L"+(i+1)+":"+mazeScore[i]);		
			}

		    moveTo(62, 27);
            printText("Level:"+mazeLevel);
			moveTo(62, 28);
            printText("Steps:"+mazeSteps);
			
		  }
		  
	  function mazeAnimatePlayer(t){  
		if (mazeAnimationStarted == 0)
		  mazeAnimationStarted = t;
		var topMargin = 8;
		var leftMargin = (w-h)/2 - 2*topMargin;
		var d = (h-2*8)/mazeSize;
        ctx.beginPath();
        ctx.arc(leftMargin+mazePx*d+d/2 + mazeProgress * d * (mazeNx - mazePx), topMargin+mazePy*d+d/2 + mazeProgress * d *(mazeNy - mazePy), d/2.5, 0, 2 * Math.PI);
        ctx.fillStyle = 'black';
        ctx.fill();

		for(var a=0; a<allowed.length; a++) {
		  var tile = allowed[a];
		  ctx.beginPath();
		  ctx.rect(tile.x, tile.y, tile.w, tile.h);
		  ctx.fillStyle = "black"; 
		  ctx.fill();
		}		
		
        mazeProgress = (t - mazeAnimationStarted) / 200.0;	
        ctx.beginPath();
        ctx.arc(leftMargin+mazePx*d+d/2 + mazeProgress * d * (mazeNx - mazePx), topMargin+mazePy*d+d/2 + mazeProgress * d * (mazeNy - mazePy), d/3, 0, 2 * Math.PI);
        ctx.fillStyle = 'rgba(250,0,0,1)';
        ctx.fill();		

		ctx.strokeStyle = 'red';
		ctx.lineWidth = 2;
		drawLine(ctx, leftMargin+(mazeSize-1)*d+3, topMargin+(mazeSize-1)*d+3, leftMargin+(mazeSize-1)*d+d-4, topMargin+(mazeSize-1)*d+d-4);	
		drawLine(ctx, leftMargin+(mazeSize-1)*d+d-4, topMargin+(mazeSize-1)*d+3, leftMargin+(mazeSize-1)*d+3, topMargin+(mazeSize-1)*d+d-4);
		ctx.lineWidth = 1; 	
		
		if (mazeProgress<=1)
		  window.requestAnimationFrame(mazeAnimatePlayer)
		else
		  mazeFinishAnimation();
	  }
	  
	  function mazeStartAnimation(newx,newy, callback) {
	    mazeNx = newx;
		mazeNy = newy;
		mazeAnimationStarted = 0;
		mazeProgress = 0;
		mazeAnimationCallback = callback;
		window.requestAnimationFrame(mazeAnimatePlayer);
	  }
	  
	  function mazeFinishAnimation() {
	    mazePx = mazeNx;
		mazePy = mazeNy;
		mazeProgress = 0;
		mazeSteps++;
		if (mazePx == mazeSize-1 && mazePy == mazeSize-1){
		    mazeScore.push(mazeSteps);
		    runMaze(mazeLevel+1);
		} else {
		    mazeAnimationCallback();
		}
	  }
		
		function runMaze(level) {
          moveTo(0,0);
	      stopCoursor();
	      coursorVisible(false);	
          mazeLevel = level;		  
		  mazeSize = 5+level*2;
		  mazePx = 0;
		  mazePy = 0;
		  maze = createMaze(mazeSize, mazeSize);	
		  drawMaze();
		  mazeSteps = 0;
		  mazeMode = true;
		  if (mazeLevel == 51) {
			var cx = (w/charWidth) / 2;
			var cy = (h/charHeight) / 2;
			ctx.fillStyle = "black";	
			ctx.fillRect((cx-15)*charWidth, (cy-3)*charHeight, 30*charWidth-2, 6*charHeight+4); 			
			moveTo(cx-11,cy-2);
			setColor("greenyellow");
			printText("!!! CONGRATULATIONS !!!")
			moveTo(cx-4,cy-1);
			printText("You Won!");
			moveTo(cx-9,cy);
			printText("Sum of steps: "+(mazeScore.reduce((partialSum, a) => partialSum + a, 0)));
			moveTo(cx-11,cy+2);
			printText("[P]lay again or E[x]it");
			ctx.fillStyle = "deeppink";		
			ctx.fillRect((cx-15)*charWidth, (cy-3)*charHeight, 30*charWidth-2, 8);  			
			ctx.fillRect((cx-15)*charWidth, (cy+3)*charHeight+4, 30*charWidth-2, 8); 
            ctx.fillRect((cx-15)*charWidth, (cy-3)*charHeight, 8, 6*charHeight+4); 
            ctx.fillRect((cx+15)*charWidth, (cy-3)*charHeight, 8, 6*charHeight+4); 		  
		  }
		}
		
		function egg2Animation(t) {
		  var img = document.getElementById("egg2");
		  if (t>0) {
		    if (egg2StartT == -1) {
			  egg2StartT = t;
			} else {
			  var progress = t - egg2StartT;
			  var target = 3 + 30000-Math.cos(progress/2250)*30000;
			  var scale = w/target;
			  var alpha = t/10000;
			  var r = Math.ceil(1/scale)*2;
			  
			  ctx.fillStyle = "black";
			  ctx.fillRect(0, 0, w, h);	
			  
			  for(var x=-r-1; x<= r+1; x++) {
			      for(var y = -r-1; y<= r+1; y++) {
				    var x1 = (x-0.5)*scale*w;
					var y1 = (y-0.5)*scale*w;
					
					var gx = Math.floor(Math.abs(x)) % 32;
					var gy = Math.floor(Math.abs(y)) % gc.length;
					var n = gc[gy];
					var mask = 1 << (32-gx);
					b = n & mask;
						
                    if (!b) {
						ctx.save();
						ctx.translate(w/2,h/2);
						ctx.rotate(alpha);
						ctx.drawImage(img, x1,y1, w*scale, w*scale); 
						ctx.restore();
					}
				  }
			  }
			}
		  }
		  
		  if (easterEggMode2)
		      window.requestAnimationFrame(egg2Animation);
		}
		
		function runEgg2() {
		    easterEggMode2 = true;
			playerAudio = new Audio("zoom.mp3");
			playerAudio.loop = true;
			playerAudio.play();			
			egg2StartT = -1;
            window.requestAnimationFrame(egg2Animation);
		}
		
		function shutdown(t) {
		  if (t <= 0) {
		    if (t == 0) {
		        playerAudio.pause();
			  	playerAudio = new Audio("glitch.mp3");
				playerAudio.play();
			}
			if (t>-50) {
				for(var i=0; i<20; i++) {
					var x1 = Math.floor(Math.random()*w);
					var y1 = Math.floor(Math.random()*h);
					var x2 = Math.floor(Math.random()*(w-x1));
					var y2 = Math.floor(Math.random()*(h-y1));
					var kx = 3-Math.random()*6;
					var ky = 3-Math.random()*6;
					ctx.drawImage(canvas, x1,y1, x2, y2, x1+kx,y1+ky, x2, y2);
				}
				
				setTimeout(_=>{shutdown(t-1);}, 30+Math.random()*150);
            } else {
			   ctx.fillStyle = "#17B106";
			   ctx.fillRect(0, 0, w, h);				
			   playerAudio.pause();		   
			   setTimeout(_=>{
			     coursorVisible(false);
				 //TODO
				 }, 2500);
			}
		  } else {
              if (t==50) {
			  	playerAudio = new Audio("buzz.mp3");
				playerAudio.play();
			  }
		      moveTo(Math.floor(Math.random()*w/charWidth), Math.floor(Math.random()*(h-2*charHeight)/charHeight));
			  printText(Math.random() < 0.33 ? "SYSTEM MALFUNCTION" : (Math.random() < 0.35 ? "SEGMENTATION FAULT" : "FATAL ERROR!"));
			  setTimeout(_=>{shutdown(t-1);}, 10+Math.random()*90);
		  }
		}

		function runPrompt() {
		   coursorVisible(true);
		   var path = [];
		   for(var i=0; i<curPath.length; i++) {
		     path.push(curPath[i].name);
		   }
		   var pathStr = path.join('\\');
		   prompt(pathStr+"\>", function(command) { 
		       command = preprocess(command);
			   var lines = command.split(' ');
		       setColor("lightgreen");
			   var cmd = lines[0].toUpperCase();
			   var cmdMD5 = MD5(cmd).toUpperCase();	
			   var accessDenied = false;
			   var curDir = curPath[curPath.length-1];
			   for(var i=0; i<dosCommands.length; i++) {
			       if (cmd==dosCommands[i]) {
				     accessDenied = true;
				   }
			   }
			   if (accessDenied) {
			     printText("Access denied.");newLine();
			   } else if (cmd == "HELP" || cmd == "POMOC" || cmd == "POMOCY" || cmd == "?" || cmd == "FASTHELP") {
			       printText("    Try DIR or CD to begin"); newLine();
				   printText("    If you are helpless google 'msdos commands'"); newLine();
				   printText("    Jeśli nie masz pojęcia co się dzieje - wygugluj 'komendy dosa'"); newLine();
			   } else if (cmd == "CD..") {
				 if (curPath.length > 1) {
					 curPath.pop();
				 } 
			   } else if (cmd == "ECHO") {
			     if (lines.length>1) {
				   printText(command.substring(5));newLine();
				 }
			   } else if (cmd == "CHKDSK") {
			     if (lines.length == 1) {
				   printText("Missing argument to CHKDSK.");newLine(); 
				 } else {
				   if (lines[1].toUpperCase() == "C:") {
				      printText("The type of the file system is FAT16\nCHKDSK is veryfying files...completed\nCHKDSK is veryfying indexes...completed\n\n    168 234 612 KB Total disk space.\n    84 123 417 KB in 395 files.\n    0 KB in bad sectors.\n    76 340 500 KB  available on disk.\n\n");newLine(); 
				   } else {
				     printText("No such disk: "+lines[1]);newLine(); 
				   }
				 }
			   } else if (cmd == "TIME" || cmd == "DATE" || cmd == "DATETIME") {
			       printText(new Date().toLocaleString()); newLine();
			   } else if (cmd == "VOL") {
			       printText("Volume in drive C is GEOCACHE:)\n");
			   } else if (cmd==":)") {
			       startEesterEgg();
				   return;
			   } else if (cmdMD5==egg2MD5) {
			       runEgg2();
				   return;
			   } else if (cmd == "TYPE" || cmd == "MORE" || cmd=="CAT") {
			     if (lines.length == 1) {
				   printText("Missing argument to TYPE.");newLine(); 
				 } else {
				   var type = lines[1].toUpperCase();
				   var file = null;
				   for(var i=0; i<curDir.content.length; i++) {
					 if (curDir.content[i].name == type) {
					   file = curDir.content[i];
					 }
				   }
				   
				   if (file == null) {
					 printText("No such file.");newLine();
				   } else if (file.dir) {
					 printText(file.name+ " is directory.");newLine(); 
				   } else if (!file.access) {
					 printText("Access denied.");newLine(); 
				   } else if (file.data) {
					 var txt = file.data;
					 printText(file.data);
					 newLine();
				   } else {
				     printText("File contains binary data that cannot be displayed.");newLine(); 
				   }
				 }
			   } else if (cmd == "CD") {
			     if (lines.length == 1) {
				   printText("Missing argument to cd.");newLine(); 
				 } else {
				   var cd = lines[1].toUpperCase();
				   if (cd == ".") {
				   } else if (cd == "..") {
				     if (curPath.length > 1) {
					     curPath.pop();
					 } 
				   } else {
					   var newDir = null;
					   for(var i=0; i<curDir.content.length; i++) {
						 if (curDir.content[i].name == cd) {
						   newDir = curDir.content[i];
						 }
					   }
					   
					   if (newDir == null) {
						 printText("No such directory.");newLine();
					   } else if (!newDir.dir) {
						 printText(newDir.name+ " is not directory.");newLine(); 
					   } else if (!newDir.access) {
						 printText("Access denied.");newLine(); 
					   } else {
						 curPath.push(newDir);
					   }
				   }
				 }
			   } else if (cmd == "DIR" || cmd == "LS") {
				 printText("Volume in drive C is OS."); newLine();
				 printText("Volume Serial Number is xxxx-xxxx"); newLine();
				 printText("Directory of "+pathStr); newLine(); newLine();
				 var dirCount = 0;
			     for(var i=0; i<curDir.content.length; i++) {
				   printText("    "+curDir.content[i].name+(" ".repeat(16-curDir.content[i].name.length))+(curDir.content[i].dir ? "<DIR>" : "     ")+"    2024-09-10 06:33" );
				   newLine();
				   if (curDir.content[i].dir) dirCount++;
				 }
				 newLine();
				 printText((curDir.content.length-dirCount)+" File(s), "+dirCount+" Directories");
				 newLine();
				 newLine();
			   } else if (cmd == "CLEAR" || cmd == "CLR") {
					ctx.fillStyle = "black";
					ctx.fillRect(0, 0, w, h);	
					moveTo(0,0);
					runPrompt();
				    return;
			   } else if ((cmd == "QUIZ.EXE" || cmd == "QUIZ" || cmd == "./QUIZ" || cmd == "./QUIZ.EXE") && curDir.name=="QUIZ") {
			       runQuiz();
				   return;
			   } else if ((cmd == "SNAKE.EXE" || cmd == "SNAKE" || cmd == "./SNAKE" || cmd == "./SNAKE.EXE") && curDir.name=="SNAKE") {
			       runSnake();
				   return;
			   } else if ((cmd == "MAZE.EXE" || cmd == "MAZE" || cmd == "./MAZE" || cmd == "./MAZE.EXE") && curDir.name=="MAZE") {
			       mazeScore = [];
                   runMaze(1);	
				   return;
			   } else if ((cmd == "PLAYER.EXE" || cmd == "PLAYER" || cmd == "./PLAYER" || cmd == "./PLAYER.EXE") && curDir.name=="MUSIC") {
			       printText("Music Player v.0.9b\n");
				   if (lines.length == 1) {
				     printText("Usage: PLAYER.EXE <file>\n\n");
				   } else {
					   var file = null;
					   for(var i=0; i<curDir.content.length; i++) {
						 if (curDir.content[i].name.toUpperCase() == lines[1].toUpperCase()) {
						   file = curDir.content[i];
						 }
					   }
					   
					   if (file==null) {
						  printText("File "+lines[1]+" not found.\n");
					   } else {
						   printText("\n    Playing: "+file.name+".\n    File info: "+file.info+"\n    Press any key to exit\n\n");
						   playerAudio = new Audio(file.audio);
						   playerAudio.addEventListener("ended", exitAudio);
						   playerAudio.play();
						   coursorVisible(false);
						   var ay = curY;
						   audioInterval = setInterval(_=>  {
						       var progress = Math.floor(playerAudio.currentTime);
							   var duration = Math.floor(playerAudio.duration);
							   if (playerAudio.currentTime>=0 && playerAudio.duration>0) {
								   moveTo(4,ay);
								   var d = 1+Math.floor((30*progress)/duration);
								   if (d>30) d=30;
								   var str = "#".repeat(d)+"-".repeat(30-d);
								   var c = "|/-\\|/-\\";
								   var s = Math.floor(playerAudio.currentTime*10)%8;
								   printText(prettyTime(progress)+" ["+str+"] "+prettyTime(duration)+" ("+c.substring(s,s+1)+")");
							   }
						   },10);
						   return;
					   }
                   }				   
			   } else if (command.length==0) {
			     //nothing
			   } else if (curDir.name=="DEMOS") {
			       var file = null;
				   for(var i=0; i<curDir.content.length; i++) {
					 if (curDir.content[i].name.toUpperCase() == cmd.toUpperCase() || curDir.content[i].name.toUpperCase() == "./"+cmd.toUpperCase()) {
					   file = curDir.content[i];
					 }
			       }
				   if (file==null) {
					  printText("I don't know how to "+cmd.toLowerCase()+".");newLine(); 
				   } else {
					   printText("Opening external program... (allow popup windows / zezwól na wyskakujące okienka)\n\n");
					   setTimeout(_=>{window.open(file.url, '_blank').focus(); runPrompt();}, 1500);
					   return;
				   }
			   } else {
			     printText("I don't know how to "+cmd.toLowerCase()+".");newLine(); 
			   }

		       runPrompt();
		   });
		}
		
		function begin() {
			moveTo(0, 0)
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, w, h);
			coursorVisible(true);
			language = "pl";
			answers = ""
			invalid = 0;
			questionNr = 0;
			easterEggMode = false;
			setColor("lightgreen");
			printText("MSDOS 6.22 (c) Microsoft Corp. 1988");newLine(); 
			printText("Build modified by PanJanek123 ;)");newLine();newLine();        
            runPrompt();			
    	}
		
        begin();


	</script>
  </body>
</html>